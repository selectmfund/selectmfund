<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Mutual Fund NAV Data</title>
</head>
<body>
    <h1>Download Mutual Fund NAV Data</h1>
    <button id="downloadButton">Download NAV Data</button>

    <script>
        // Function to download the JSON file
        function downloadFile(data, filename) {
            const file = new Blob([data], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(file);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Fetch data from the main mutual funds list
        async function fetchMutualFundsList() {
            const response = await fetch('https://api.mfapi.in/mf');
            return await response.json();
        }

        // Fetch historical NAV for a specific mutual fund
        async function fetchMutualFundNAV(fundId) {
            const response = await fetch(`https://api.mfapi.in/mf/${fundId}`);
            return await response.json();
        }

        document.getElementById('downloadButton').addEventListener('click', async () => {
            try {
                const mutualFundsList = await fetchMutualFundsList();
                let allNAVData = {};

                for (let i = 0; i < mutualFundsList.length; i++) {
                    const fundId = mutualFundsList[i].schemeCode;
                    console.log(`Fetching NAV data for Fund ID: ${fundId}`);
                    const navData = await fetchMutualFundNAV(fundId);
                    allNAVData[fundId] = navData;
                }

                // Convert data to JSON string
                const navDataJson = JSON.stringify(allNAVData, null, 2);
                // Trigger file download
                downloadFile(navDataJson, 'mutual_funds_nav_data.json');
                alert('Download complete!');

            } catch (error) {
                console.error('Error fetching data:', error);
                alert('An error occurred while fetching NAV data.');
            }
        });
    </script>
</body>
</html>
